<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pixel Canvas — 10 pixels / 10 minutes</title>
<style>
  :root {
    --bg: #0f1115;
    --card: #ffffff;
    --text: #0f1115;
    --muted: #6b7280;
    --accent: #3b82f6;
    --ok: #10b981;
  }
  html, body { height: 100%; margin: 0; background: var(--bg); font-family: system-ui, sans-serif; }
  .wrap { display: grid; place-items: center; min-height: 100%; padding: 20px; }
  .card { background: var(--card); color: var(--text); width: min(100%,980px); border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.15); overflow: hidden; }
  header { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid #e5e7eb; gap: 12px; flex-wrap: wrap; }
  header h1 { font-size: 18px; margin: 0; }
  .stats { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
  .pill { padding: 6px 10px; border-radius: 999px; background: #f3f4f6; font-size: 13px; }
  .pill.ok { background: #ecfdf5; color: var(--ok); border: 1px solid #d1fae5; }
  .controls { display: flex; gap: 10px; align-items: center; }
  .controls label { display: flex; align-items: center; gap: 5px; }
  .canvas-wrap { background: white; border-top: 1px solid #e5e7eb; }
  canvas { display: block; width: 100%; height: 70vh; max-height: 720px; touch-action: none; cursor: crosshair; image-rendering: pixelated; }
  footer { padding: 10px 16px; font-size: 12px; color: var(--muted); border-top: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <header>
      <h1>Pixel Canvas — 10 pixels every 10 minutes</h1>
      <div class="stats">
        <span class="pill" id="remaining-pill">Remaining: 10</span>
      </div>
      <div class="controls">
        <label>Color <input type="color" id="color" value="#ff0000"></label>
      </div>
    </header>
    <div class="canvas-wrap">
      <canvas id="canvas"></canvas>
    </div>
    <footer>
      <div>Persistent shared canvas. Place up to 10 pixels every 10 minutes. Tokens persist in your browser.</div>
    </footer>
  </div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

// Supabase config
const SUPABASE_URL = "https://pemfxpowmsajsxsveoli.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBlbGZ4cG93bXNhanN4c3Zlb2xpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3NjYyNzMsImV4cCI6MjA3MTM0MjI3M30.SJBgs4kQTqyn6S6A3usxTHaWK-nb2R51DMznT6geA_M";
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Grid config
const gridWidth = 100;
const gridHeight = 60;
const pixelSize = 10;

// Canvas
const canvas = document.getElementById("canvas");
canvas.width = gridWidth * pixelSize;
canvas.height = gridHeight * pixelSize;
const ctx = canvas.getContext("2d");

// UI
const colorInput = document.getElementById("color");
const remainingPill = document.getElementById("remaining-pill");

// Pixel state
const pixels = new Map(); // key = x_y, value = color
let remaining = 10;

// Helpers
function key(x,y){ return `${x}_${y}`; }
function drawPixel(x,y,color){ ctx.fillStyle=color; ctx.fillRect(x*pixelSize,y*pixelSize,pixelSize,pixelSize); }
function updateInfo(){ remainingPill.innerText = `Remaining: ${remaining}`; }

// Load existing pixels
async function loadPixels(){
  const { data } = await supabase.from("pixels").select("*");
  if(data) data.forEach(p => {
    pixels.set(key(p.x,p.y), p.color);
    drawPixel(p.x,p.y,p.color);
  });
}

// Real-time updates
supabase.channel("public:pixels")
  .on("postgres_changes",{ event:"INSERT", schema:"public", table:"pixels" }, payload=>{
    const p = payload.new;
    const k = key(p.x,p.y);
    if(!pixels.has(k)){
      pixels.set(k,p.color);
      drawPixel(p.x,p.y,p.color);
    }
  })
  .subscribe();

// Place pixel
async function placePixel(x,y,color){
  const k = key(x,y);
  if(pixels.has(k)) return;
  if(remaining<=0){ alert("No pixels left! Wait for refill."); return; }
  remaining--;
  pixels.set(k,color);
  drawPixel(x,y,color);
  updateInfo();
  await supabase.from("pixels").insert({x,y,color});
}

// Handle clicks
canvas.addEventListener("click", e=>{
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left)/pixelSize);
  const y = Math.floor((e.clientY - rect.top)/pixelSize);
  placePixel(x,y,colorInput.value);
});

// Refill tokens every 1 min
setInterval(()=>{
  if(remaining<10){
    remaining++;
    updateInfo();
  }
}, 60000);

// Init
loadPixels();
updateInfo();
</script>
</body>
</html>
